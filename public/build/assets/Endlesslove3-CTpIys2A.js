import{S as A,a as N,s as O,e as p,b as M,d,o as y,f as h,g,A as _,B as k,C as j,j as m,p as x,v as b,E as H,y as B,F as w,l as F,G,H as J}from"./app-BLZrBooF.js";import{a as P}from"./ably-gQ_aij9E.js";import{f as R}from"./index-CT80OGxi.js";function C(i,e,t){const o=i.slice();return o[8]=e[t],o[10]=t,o}function S(i){let e,t=[],o=new Map,n,a=b(i[2]);const s=l=>l[8].id;for(let l=0;l<a.length;l+=1){let r=C(i,a,l),u=s(r);o.set(u,t[l]=T(u,r))}return{c(){e=p("div");for(let l=0;l<t.length;l+=1)t[l].c();d(e,"class","grid grid-cols-3 gap-10 px-10 py-10")},m(l,r){h(l,e,r);for(let u=0;u<t.length;u+=1)t[u]&&t[u].m(e,null);n=!0},p(l,r){r&12&&(a=b(l[2]),H(),t=B(t,r,s,1,l,a,o,e,J,T,null,C),j())},i(l){if(!n){for(let r=0;r<a.length;r+=1)_(t[r]);n=!0}},o(l){for(let r=0;r<t.length;r+=1)k(t[r]);n=!1},d(l){l&&m(e);for(let r=0;r<t.length;r+=1)t[r].d()}}}function T(i,e){let t,o,n,a,s,l,r,u;function v(){return e[4](e[10])}return{key:i,first:null,c(){t=p("div"),o=p("img"),a=M(),w(o.src,n=e[8].url)||d(o,"src",n),d(o,"alt","Heart"),d(o,"class","w-16"),this.first=t},m(c,f){h(c,t,f),g(t,o),g(t,a),l=!0,r||(u=F(o,"click",v),r=!0)},p(c,f){e=c,(!l||f&4&&!w(o.src,n=e[8].url))&&d(o,"src",n)},i(c){l||(s&&s.end(1),l=!0)},o(c){c&&(s=G(t,R,{y:-200,duration:500})),l=!1},d(c){c&&m(t),c&&s&&s.end(),r=!1,u()}}}function E(i){let e;return{c(){e=p("div"),e.innerHTML='<div class="fixed bottom-3 text-center text-white font-mono"><p class="text-4xl">Thank you for participating.</p></div>',d(e,"class","full-screen-bg svelte-17swels")},m(t,o){h(t,e,o)},d(t){t&&m(e)}}}function U(i){let e,t,o,n=i[0]&&S(i),a=!i[0]&&E();return{c(){e=p("main"),n&&n.c(),t=M(),a&&a.c(),d(e,"class","relative w-screen h-screen overflow-hidden flex justify-center items-center"),y(e,"background-color",i[1])},m(s,l){h(s,e,l),n&&n.m(e,null),g(e,t),a&&a.m(e,null),o=!0},p(s,[l]){s[0]?n?(n.p(s,l),l&1&&_(n,1)):(n=S(s),n.c(),_(n,1),n.m(e,t)):n&&(H(),k(n,1,1,()=>{n=null}),j()),s[0]?a&&(a.d(1),a=null):a||(a=E(),a.c(),a.m(e,null)),(!o||l&2)&&y(e,"background-color",s[1])},i(s){o||(_(n),o=!0)},o(s){k(n),o=!1},d(s){s&&m(e),n&&n.d(),a&&a.d()}}}async function z(){try{const i=await fetch("/api/updatelove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!i.ok)throw new Error("Network response was not ok");const e=await i.json();console.log("Love count updated:",e)}catch(i){console.error("Error updating love count:",i)}}function D(i,e,t){let o=!0,n=0,a="#080101",s,l;x(()=>{s=new P.Realtime({authUrl:"/ablyauth"}),s.connection.once("connected",()=>{l=s.channels.get("get-started")}),s.connection.on("failed",c=>{console.error("Connection failed:",c)}),t(0,o=!0)});let r=Array(10).fill(null).map((c,f)=>({id:f,url:"https://kolown.net/assets/gitm/heart.svg"}));async function u(c){n+=1,console.log("click:"+n),l.publish("endless","love");let f=["state1","state2","state3","state4","state5"],L=f[Math.floor(Math.random()*f.length)];t(2,r=r.filter((I,q)=>q!==c)),r.length===0&&(t(0,o=!1),l.publish("state",L),setTimeout(()=>{s.connection.close(),z(),t(1,a="#080101")},100))}return[o,a,r,u,c=>u(c)]}class W extends A{constructor(e){super(),N(this,e,D,U,O,{})}}export{W as default};
